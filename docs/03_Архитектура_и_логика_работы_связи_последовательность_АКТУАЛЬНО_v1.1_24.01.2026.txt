Архитектура, связи, логика выполнения и последовательность работы
Версия: v1.1 24.01.2026

1) Общая архитектура (слои)
Система модульная: Core управляет жизненным циклом прогона, Modules выполняют проверки, Storage хранит данные, Reporting формирует отчёты/артефакты, UI отображает и управляет.

1.1 Presentation (UI, Avalonia + MVVM)
- 4 вкладки верхнего уровня: UI тестирование / HTTP тестирование / Сеть и безопасность / Прогоны.
- Единый шаблон экрана модуля: секции сверху вниз, вертикальная прокрутка.
- Управление тестами: ComboBox сохранённых тестов + Загрузить/Сохранить + Название/Описание.
- Управление профилем: выбор/сохранение RunProfile (шаблон).
- Управление прогоном: Start/Stop/Cancel, прогресс, итог, детали, артефакты, лог.
- Вкладка “Прогоны”: фильтры, детали, открыть отчёты/папку, копировать RunId, повторить запуск.

1.2 Core (Orchestrator / Execution Engine)
- принимает TestCaseSettings + RunProfile,
- валидирует настройки,
- создаёт RunId и запись TestRun (Running) в БД,
- создаёт папку runs/{RunId}/,
- (опционально) выполняет preflight,
- запускает workers (Parallelism) в режиме Iterations/Duration,
- собирает ModuleResult (summary/details/artifacts),
- завершает прогон: статус + сохранение результатов + запуск Reporting,
- (опционально) отправляет Telegram уведомление.

1.3 Modules (10 модулей)
Каждый модуль реализует единый контракт:
- Validate(settings) -> список ошибок
- ExecuteAsync(settings, runContext, ct) -> ModuleResult
Модули не зависят от UI. Они возвращают результаты в общем формате.

1.4 Storage (SQLite + runs/)
- SQLite: тесты, версии, профили, прогоны, детализация, ссылки на артефакты.
- Файлы: runs/{RunId}/report.json, report.html (опц.), screenshots/, logs/.

1.5 Reporting (формирование отчётов и артефактов)
- формирует report.json (всегда),
- формирует report.html (опционально),
- сохраняет логи и прочие артефакты,
- записывает ссылки на артефакты в БД.

1.6 Integrations (Telegram)
- отправка краткого статуса прогона,
- ошибка Telegram не меняет статус прогона (фиксируется в БД/логах отдельно).

2) Единые сущности и термины
2.1 TestCase
- Id, Name, Description, ModuleType
- CurrentVersion
- Versions: payload JSON (настройки модуля, процедура, ожидания)

2.2 RunProfile
- Parallelism, Iterations/Duration, Timeouts
- Headless (UI), ScreenshotsPolicy (UI)
- HtmlReportEnabled, TelegramEnabled
- Фиксация snapshot в TestRun

2.3 TestRun
- RunId
- TestCaseId + версия теста
- ProfileSnapshotJson
- Status, StartedAt, FinishedAt
- SummaryJson (итоговые метрики)

2.4 ModuleResult
- Summary (метрики/итог)
- Details (элементы проверки: шаги/endpoint’ы/ассеты/порты/проверки)
- Artifacts (список файлов)

3) Статусы (формальные определения)
- Success: все элементы проверки прошли согласно ожиданиям.
- Failed: критическая ошибка или останов по политике, не позволяющий корректно завершить процедуру.
- Partial: прогон завершился, но часть элементов не прошла при разрешённой политике продолжения.
- Cancelled: пользователь отменил выполнение.

4) Последовательность выполнения прогона (сквозной сценарий)
Шаг 1: выбор модуля, теста и профиля.
Шаг 2: Start → Validate → создание RunId, TestRun=Running, папка runs/{RunId}/.
Шаг 3: (опционально) Preflight (либо модуль C4 отдельно, либо этап по чекбоксу профиля).
Шаг 4: Running → запуск workers (Parallelism) в режиме Iterations/Duration.
Шаг 5: Сбор результатов → UI получает прогресс и лог.
Шаг 6: Saving/Reporting → запись в БД, формирование report.json (+ report.html опц.), сохранение артефактов.
Шаг 7: (опционально) Telegram → отправка статуса; при ошибке фиксируется событие.
Шаг 8: Done → UI показывает итог/детали; запись доступна во вкладке “Прогоны”.
