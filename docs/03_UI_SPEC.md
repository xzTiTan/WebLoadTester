
# UI-спецификация — экраны, элементы, поведение

**Версия:** v1.8 11.02.2026

**Назначение:** описывает состав экранов, UX-правила и валидируемые UI-ограничения.  
**См. также:** [01_CANON.md](01_CANON.md), [02_TECH_SPEC.md](02_TECH_SPEC.md), [04_CODE_MAP.md](04_CODE_MAP.md), [05_GLOSSARY.md](05_GLOSSARY.md).

## 0. Связанные документы
- Канон: `01_CANON.md`
- Тех.спецификация: `02_TECH_SPEC.md`
- Карта кода: `04_CODE_MAP.md`
- Глоссарий: `05_GLOSSARY.md`

---

## 1. UI-концепция (верхний уровень)
Главное окно — единая рабочая область с:
- верхней панелью статусов и управления,
- 4 вкладками верхнего уровня,
- общим логом выполнения,
- диалогом настроек.

**Вкладки верхнего уровня (обязательные):**
1) UI тестирование
2) HTTP тестирование
3) Сеть и безопасность
4) Прогоны

Реализация: `Presentation/Views/MainWindow.axaml` + `Presentation/ViewModels/MainWindowViewModel.cs`.

---

## 2. Верхняя панель (header/status)
Элементы:
- Кнопки: **Старт**, **Стоп**, **Отмена** (в зависимости от состояния).
- Тексты: `Статус`, `Прогресс`, `Стадия`.
- Бейджи: `БД: ok/err`, `Telegram: ok/warn`.
- Кнопка «Настройки» (открывает окно Settings).

Поведение:
- Старт активен только если выбран модуль и настройки валидны.
- Стоп/Отмена — только при запущенном прогоне.
- Статусы обновляются из `ProgressBus` и `LogBus`.

---

## 3. Единый шаблон экрана модуля
Каждый модуль отображается по одному паттерну «сверху вниз» и обязательно имеет вертикальную прокрутку.

Секции:
1) Выбор модуля (список модулей семейства)
2) Test Library: выбор теста/версии + кнопки Сохранить/Загрузить
3) Настройки модуля (SettingsViewModel → SettingsView)
4) RunProfile (общие параметры запуска)
5) (опционально) Последний отчёт/сводка

Требования к адаптивности:
- Никаких наложений текста.
- При уменьшении окна появляется вертикальный scroll.

---

## 4. RunProfile (общая панель параметров запуска)
Поля (по факту доменной модели `Core/Domain/RunEntities.cs`):
- `Mode`: Iterations | Duration
- `Iterations`
- `DurationSeconds`
- `Parallelism`
- `TimeoutSeconds`
- `Headless`
- `ScreenshotsPolicy`: Never | OnError | Always
- `HtmlReportEnabled`
- `TelegramEnabled`
- `PreflightEnabled`

UX-правила:
- Для Mode=Iterations показываем Iterations, скрываем DurationSeconds (или делаем disabled).
- Для Mode=Duration показываем DurationSeconds, скрываем Iterations.
- Для больших значений показываем предупреждение (см. Канон §8).

---

## 5. Test Library (управление тестами)
Цель: хранить тест как объект + версии.

Элементы:
- ComboBox: список тестов для текущего модуля.
- ComboBox: версия теста.
- Кнопки: «Сохранить как новую версию», «Загрузить», «Создать новый тест».

Минимальная логика:
- Сохранение всегда создаёт новую `TestCaseVersion`.
- Запуск использует выбранную версию.

---

## 6. Вкладка «Прогоны»
Цель: история запусков и повтор.

Элементы:
- Таблица прогонов (RunId, модуль, статус, время, длительность, failed items).
- Фильтры: модуль, статус, период, поиск по RunId.
- Панель деталей выбранного прогона:
  - ссылки на `report.json`, `report.html` (если есть), `logs/run.log`, screenshots,
  - кнопка «Открыть папку»,
  - кнопка «Повторить запуск».

Реализация: `Presentation/ViewModels/Tabs/RunsTabViewModel.cs`.

---

## 7. Окно настроек
Окно Settings включает:
- пути хранения (DataDirectory/RunsDirectory),
- проверку доступности БД,
- настройки Telegram (token/chatId, режимы уведомлений).

Важно:
- Telegram настройки не обязаны быть заполнены; отсутствие токена = «не настроен».
- Ошибка Telegram при отправке — только лог/предупреждение.

---

## 8. Локализация и терминология
- Основной UI — на русском.
- Термины в UI должны соответствовать `05_GLOSSARY.md`.

---

## 9. Мини-таблица «типы шагов UiScenario» (для документации)
Используется в описании сценариев и в UI подсказках.

| Тип шага | Назначение | Минимальные поля |
|---|---|---|
| Navigate | Переход на URL | Url |
| WaitForSelector | Ожидание элемента | Selector, Timeout |
| Click | Клик по селектору | Selector |
| AssertText | Проверка текста | Selector, Expected |
| Screenshot | Скриншот (обычно при ошибке) | FileName/Policy |

---

## Связанные файлы / входы / выходы
- Входы: ограничения из `01_CANON.md`, структура данных из `02_TECH_SPEC.md`.
- Выходы: требования к `Presentation/*`, проверки в `06_TEST_PLAN.md`.
