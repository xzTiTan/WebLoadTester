
# UI-спецификация — экраны, элементы, поведение

**Версия:** v1.2 10.03.2026

## 0. Связанные документы
- Канон: `01_КАНОН_ПРОЕКТА_И_ТЗ...`
- Тех.спецификация: `02_ТЕХ_СПЕЦИФИКАЦИЯ...`
- Карта кода: `04_КАРТА_КОДА_И_СВЯЗИ...`

---

## 1. UI-концепция (верхний уровень)
Главное окно — единая рабочая область с:
- верхней панелью статусов и управления,
- 4 вкладками верхнего уровня,
- общим лог-дроуэром выполнения,
- диалогом настроек.

**Вкладки верхнего уровня (обязательные):**
1) UI тестирование
2) HTTP тестирование
3) Сеть и безопасность
4) Прогоны

Реализация: `Presentation/Views/MainWindow.axaml` + `Presentation/ViewModels/MainWindowViewModel.cs`.

---

## 2. Верхняя панель (header/status)
Элементы:
- Кнопки: **Старт**, **Стоп**, **Отмена** (в зависимости от состояния).
- Тексты: `Статус`, `Прогресс`, `Стадия`.
- Бейджи: `БД: ok/err`, `Telegram: ok/warn`.
- Кнопка «Настройки» (открывает окно Settings).

Поведение:
- Старт активен только если выбран модуль и настройки валидны.
- Стоп/Отмена — только при запущенном прогоне.
- Статусы обновляются из `ProgressBus` и `LogBus`.

---

## 3. Единый шаблон экрана модуля
Каждый модуль отображается по одному паттерну «сверху вниз» и обязательно имеет вертикальную прокрутку.

Закреплённые ряды (pinned header):
1) **Run Control Row**: Старт/Перезапуск/Остановить/Отмена + прогресс + стадия/текст.
2) **Module Selection Row**: горизонтальный выбор модулей текущей вкладки.
3) **Module Info Row**: DisplayName + Description выбранного модуля.

Далее — один ScrollViewer с секциями:
1) **Конфигурация** (единая конфигурация на модуль, хранится в SQLite).
2) **Параметры запуска** (Iterations/Duration/Parallelism/Timeout + флаги HTML/Telegram/Preflight).
3) **Настройки модуля** (SettingsViewModel → SettingsView).
4) **Результаты** (сводка, детали, артефакты).

Требования к адаптивности:
- Никаких наложений текста.
- При уменьшении окна появляется вертикальный scroll.

---

## 4. Параметры запуска (общая панель параметров запуска)
Поля (по факту доменной модели `Core/Domain/RunEntities.cs`):
- `Mode`: Iterations | Duration
- `Iterations`
- `DurationSeconds`
- `Parallelism`
- `TimeoutSeconds`
- `Headless`
- `ScreenshotsPolicy`: Never | OnError | Always
- `HtmlReportEnabled`
- `TelegramEnabled`
- `PreflightEnabled`

UX-правила:
- Для Mode=Iterations показываем Iterations, скрываем DurationSeconds (или делаем disabled).
- Для Mode=Duration показываем DurationSeconds, скрываем Iterations.
- Для больших значений показываем предупреждение (см. Канон §8).

---

## 5. Конфигурация (единая)
Цель: единый конфиг на модуль (загрузка → заполнение всех полей → запуск).

Элементы:
- ComboBox: список конфигураций модуля.
- Поля: Имя (без пробелов), Описание, Финальное имя.
- Кнопки: Загрузить, Сохранить, Перезаписать, Удалить.

Минимальная логика:
- Сохранение доступно только при заполненных обязательных полях.
- Финальное имя сохраняется как `{UserName}_{ModuleSuffix}`.

---

## 6. Вкладка «Прогоны»
Цель: история запусков и повтор.

Элементы:
- Таблица прогонов (RunId, модуль, статус, время, длительность, failed items).
- Фильтры: модуль, статус, период, поиск по RunId.
- Панель деталей выбранного прогона:
  - ссылки на `report.json`, `report.html` (если есть), `logs/run.log`, screenshots,
  - кнопка «Открыть папку»,
  - кнопка «Повторить запуск».

Реализация: `Presentation/ViewModels/Tabs/RunsTabViewModel.cs`.

---

## 7. Окно настроек
Окно Settings включает:
- пути хранения (DataDirectory/RunsDirectory/ProfilesDirectory),
- проверку доступности БД,
- настройки Telegram (token/chatId, режимы уведомлений).

Важно:
- Telegram настройки не обязаны быть заполнены; отсутствие токена = «не настроен».
- Ошибка Telegram при отправке — только лог/предупреждение.

---

## 8. Локализация и терминология
- Основной UI — на русском.
- Термины в UI должны соответствовать `05_ГЛОССАРИЙ...`.

---

## 9. Мини-таблица «типы шагов UiScenario» (для документации)
Используется в описании сценариев и в UI подсказках.

| Тип шага | Назначение | Минимальные поля |
|---|---|---|
| Navigate | Переход на URL | Url |
| WaitForSelector | Ожидание элемента | Selector, Timeout |
| Click | Клик по селектору | Selector |
| AssertText | Проверка текста | Selector, Expected |
| Screenshot | Скриншот (обычно при ошибке) | FileName/Policy |
