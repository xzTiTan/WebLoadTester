# WebLoadTester — UI спецификация и полное описание ПО (единственный исходный документ)

**Версия документа:** v3.3 16.02.2026  
**Актуально для:** `WebLoadTester 16.02.2026 1pm.tar` + решения из `history_all_chats_v2 16.02.2026.md` + исходные документы `docs/*.md` этой версии (приводим к соответствию с этим документом).

Этот документ — **самодостаточная TO‑BE спецификация** продукта: по нему можно **с нуля** спроектировать и реализовать приложение (архитектура, данные, UI/UX, поведение, модули, отчётность, НФТ, правила разработки).

**Приоритет источников:**
1) этот документ (TO‑BE), 2) `docs/*.md` (AS‑IS), 3) код (AS‑IS).  
Если есть расхождение — фиксируем в «Дельта внедрения» и меняем код/документацию.

---

## 0. Принятые решения (фиксируем и реализуем)

### 0.1. Продуктовая рамка
1. **10 модулей, 3 семейства:**
   - **UI тестирование** (Playwright/Chromium)
   - **HTTP тестирование**
   - **Сеть и безопасность** (без атакующих действий)
2. Приложение — **desktop MVP**: без распределённых агентов/кластера.
3. Язык UI — **русский** (включая заголовки DataGrid, подсказки, ошибки).

### 0.2. Выполнение и параллельность
1. **UI‑модули поддерживают параллельный запуск X браузерных контекстов** (`Parallelism = X`).
   - В UI прямо пишем: «Параллельность = количество одновременных окон/контекстов».
2. **Пауза между итерациями (пейсинг)** — параметр профиля запуска: `PauseBetweenIterationsMs`.
   - Нужна для «раз в N минут» (скрины/проверки).
3. **Stop и Cancel — разные операции:**
   - **Стоп** = мягкая остановка: завершить текущую итерацию воркера и не начинать новую.
   - **Отмена** = жёсткая отмена: немедленно отменить операции (`CancellationToken`).
4. `net.availability` — **атомарный**: один `ExecuteAsync` = одна проверка.
   - Повтор/длительность/пауза задаются **профилем запуска**, не настройками модуля.
5. Telegram настройки **сохраняются персистентно** (в `settings.json`).
6. Управление конфигурациями упрощаем: остаётся `Загрузить / Сохранить / Удалить`.
   - «Перезаписать» убираем.
   - `Старт` автосохраняет **только при валидных данных**.
7. `http.functional` делаем по паттерну **list + details**.
8. Дизайн — «ровный» (единые tokens, field‑row, без наложений).
9. Тема UI фиксируется в Light (FluentTheme + `RequestedThemeVariant = Light`).

### 0.3. Лимиты безопасного MVP (AS‑IS в коде)
Сейчас валидируется в оркестраторе (RunProfileLimits):
- `Parallelism` 1..**25**
- `Mode=Iterations`: `Iterations > 0`
- `Mode=Duration`: `DurationSeconds` 1..**60**
- `TimeoutSeconds > 0`

**Важно:** `DurationSeconds <= 60` — искусственный предохранитель. Если нужен долгий прогон (например 10 минут) — фиксируем решение и поднимаем лимит.

---

## 1. Назначение, пользователи, границы продукта

**WebLoadTester** — кроссплатформенное desktop‑приложение (.NET 8 + Avalonia 11) для инженеров/разработчиков/админов:

- UI сценарии и скриншоты в браузере (Playwright);
- HTTP функциональные проверки;
- упрощённые прогоны производительности (через parallelism + iterations/duration);
- безопасная сетевая диагностика (DNS/TCP/TLS) и проверка security‑заголовков;
- библиотека конфигов и история прогонов (SQLite);
- артефакты прогонов (JSON/HTML отчёты, логи, скриншоты);
- уведомления в Telegram.

### 1.1. Что НЕ делаем
- нет распределённого запуска;
- нет атак/сканирования уязвимостей;
- нет сложного RPS‑планировщика «как в JMeter».

---

## 2. Технологический стек и зависимости

### 2.1. Стек
- .NET 8
- Avalonia 11.x (FluentTheme)
- MVVM (CommunityToolkit.Mvvm)
- Playwright for .NET (Chromium)
- SQLite (Microsoft.Data.Sqlite)
- Отчёты: JSON + HTML

### 2.2. Chromium (Playwright) — установка и UX
**Правило UX:** если Chromium не установлен — показываем баннер и кнопку установки.

- Установка из UI: кнопка **Установить Chromium** скачивает браузер в `./browsers` рядом с бинарниками.
- CLI (для документации):
  - Windows: `pwsh ./playwright.ps1 install chromium`
  - Linux: `./playwright.sh install chromium`

**TO‑BE:** баннер должен появляться для **всех UI‑модулей** (`ui.scenario`, `ui.snapshot`, `ui.timing`).

---

## 3. Архитектура и карта кода

### 3.1. Логические слои
- `Presentation/` — UI (Views, ViewModels, Styles)
- `Core/` — доменные сущности, контракты, оркестратор, отчёты
- `Modules/` — 10 модулей
- `Infrastructure/` — SQLite, settings.json, Telegram, артефакты, Playwright factory
- `docs/` — документация

### 3.2. Основные точки расширения
- Модуль реализует `ITestModule`:
  - `Id`, `DisplayName`, `Family`, `SettingsType`
  - `CreateDefaultSettings()`
  - `Validate(settings)`
  - `ExecuteAsync(settings, ctx, ct)`

- Оркестратор (`RunOrchestrator`) отвечает за:
  - проверку лимитов и валидации;
  - preflight;
  - параллельность/итерации/длительность;
  - таймаут итерации;
  - сбор `RunItem`, артефактов, отчётов.

**TO‑BE:** контекст выполнения должен включать `WorkerId` и `Iteration`.

---

## 4. Данные, хранение, артефакты

### 4.1. Папки
По умолчанию (LocalAppData):
- `DataDirectory` = `.../WebLoadTester/data`
- `RunsDirectory` = `.../WebLoadTester/runs`
- `DatabasePath` = `{DataDirectory}/webloadtester.db`

Структура прогона:
- `runs/{RunId}/report.json`
- `runs/{RunId}/report.html` (если включено)
- `runs/{RunId}/logs/run.log`
- `runs/{RunId}/screenshots/...` (UI)
- `runs/{RunId}/profile` (AS‑IS) → **TO‑BE:** `runs/{RunId}/profiles/w{WorkerId}/`.

### 4.2. settings.json
Файл: `LocalAppData/WebLoadTester/settings.json`

**AS‑IS:**
- `DataDirectory`
- `RunsDirectory`

**TO‑BE (добавляем):**
- `Telegram` (все поля из §12)

### 4.3. SQLite schema (AS‑IS)
Таблицы (см. код `Infrastructure/Storage/SqliteRunStore.cs`):
- `TestCases`, `TestCaseVersions`
- `TestRuns`, `RunItems`, `Artifacts`
- `TelegramNotifications`

**TO‑BE:** ничего принципиально нового не добавляем, кроме сохранения `PauseBetweenIterationsMs` в snapshot профиля и (опционально) статуса `Stopped`.

---

## 5. Конфигурации и профили запуска

### 5.1. Конфигурация (TestCase)
Конфигурация хранит:
- настройки модуля
- профиль запуска

Сохраняется в SQLite как версии (`TestCaseVersions.PayloadJson`).

### 5.2. Именование
Пользователь вводит **Имя (без пробелов)** → это `UserName`.  
Итоговое имя `FinalName = UserName + "_" + ModuleSuffix`.

В UI показываем:
- `Имя (без пробелов)` (editable)
- `Итоговое имя` (read‑only)

### 5.3. UX CRUD конфигураций (целевой)
- ComboBox `Конфигурация`
- Кнопки: `Загрузить`, `Сохранить`, `Удалить`
- Поля: `Имя`, `Итоговое имя`, `Описание`

Правила:
- `Сохранить` всегда создаёт **новую версию** (если конфиг существует).
- `Старт` = валидировать → автосохранить → запустить.

### 5.4. RunProfile (TO‑BE)
Добавляем `PauseBetweenIterationsMs`.

В UI профиля запуска:
- поле показывается всегда
- значение >= 0

---

## 6. Оркестратор: точное поведение

### 6.1. Порядок запуска (целевой)
1) Validate RunProfile → 2) Validate module settings → 3) Save config version → 4) Create TestRun(Running) → 5) Prepare run folder → 6) Preflight (опц.) → 7) Execute with profile → 8) Save report+items+artifacts → 9) Final status.

### 6.2. Параллельность (TO‑BE модель воркеров)
**Iterations:** N итераций делятся между `Parallelism` воркерами; каждый воркер делает `Delay(PauseBetweenIterationsMs)` между итерациями.

**Duration:** все воркеры выполняют итерации до дедлайна; между итерациями — пейсинг.

### 6.3. Таймаут итерации
Каждая итерация оборачивается в `CancelAfter(TimeoutSeconds)`.

### 6.4. Stop vs Cancel
- Cancel отменяет токен.
- Stop выставляет флаг, воркеры выходят между итерациями.

---

## 7. UI/UX канон

### 7.1. Главное окно
- статус‑панель (БД / Telegram / Playwright + Настройки)
- TabControl: UI / HTTP / Сеть / Прогоны
- нижняя панель прогресса (пинится)
- лог‑дровер (Expander): ошибки/автосролл/очистка; limit 500 строк

### 7.2. Канон компоновки вкладок
- **один ScrollViewer** на вкладку (без вложенных)
- **управление запуском** всегда доступно
- одинаковая сетка и отступы

### 7.3. ModuleWorkspace (унифицирован)
A) Конфигурация (CRUD)  
B) Настройки модуля  
C) Профиль запуска  
D) Управление запуском + «Открыть JSON/HTML/папку»

### 7.4. SettingsWindow
- Пути (Data/Runs/Database)
- Telegram (персистентно + тестовое сообщение)

### 7.5. Runs (история)
Функции:
- фильтры + таблица прогонов
- открыть JSON/HTML/папку
- копировать RunId/путь
- повторить запуск (подтянуть настройки и профиль)
- удалить прогон (с подтверждением)

---

## 8. Дизайн‑система
- tokens: отступы, размеры, радиусы
- `field-row`: label слева, control справа
- DataGrid: русские заголовки, TextTrimming, кнопки управления списком
- без наложений: правильные `Grid.ColumnDefinitions`

---

## 9. Общий пользовательский сценарий
1) выбрать модуль → 2) загрузить/создать конфиг → 3) заполнить обязательные поля → 4) настроить профиль запуска → 5) Старт → 6) отчёт/артефакты → 7) вкладка Прогоны (повтор/сравнение).

---

## 10. Модули (10 шт.): действия пользователя, обязательные поля, результат

### A. UI тестирование (Playwright)

#### A1. `ui.scenario` — UI сценарий

**Назначение:** выполнить сценарий шагов в браузере.

**Элементы управления:**
- `Стартовый URL` (TargetUrl)
- `Таймаут ожиданий, мс` (TimeoutMs)
- Таблица `Шаги`:
  - `Действие` (ComboBox)
  - `Селектор`
  - `Значение`
  - `Задержка, мс`
  - кнопки: добавить/удалить/вверх/вниз

**Обязательные поля:**
- `TimeoutMs > 0`
- `Steps.Count >= 1`
- `TargetUrl` обязателен, если первый шаг не `Переход`

**Шаги (русские названия в UI):**
- `Переход` (Navigate): `Значение` = URL (обяз.)
- `Ожидание элемента` (WaitForSelector): `Селектор` (обяз.)
- `Клик` (Click): `Селектор` (обяз.)
- `Ввод текста` (Fill): `Селектор` + `Значение` (обяз.)
- `Проверка текста` (AssertText): `Селектор` + `Значение(ожидаемый текст)` (обяз.)
- `Скриншот` (Screenshot): `Селектор` опционален
- `Пауза` (Delay): `Задержка, мс` (обяз.)

**Семантика задержки:**
- `Задержка, мс` применяется как **пауза перед выполнением шага**.
- Для `Пауза` используется это же поле.

**Профиль запуска (важно):**
- `Parallelism = X` — сколько окон/контекстов одновременно.
- `Mode`:
  - Iterations: сценарий выполнится N раз (распределено по X воркерам).
  - Duration: сценарий выполняется до дедлайна.
- `PauseBetweenIterationsMs` позволяет сделать «раз в N минут».
- `Headless` и `Скриншоты`.

**Что получает пользователь:**
- `report.json` и (опц.) `report.html`
- `logs/run.log`
- `screenshots/` (по политике)
- в отчёте: элемент на каждый шаг (ok/fail, duration, error, путь скрина).

**TO‑BE для параллельности:**
- профили браузера: `runs/{RunId}/profiles/w{WorkerId}`
- скриншоты: `runs/{RunId}/screenshots/w{WorkerId}`

#### A2. `ui.snapshot` — UI снимки

**Назначение:** сделать скриншоты набора URL/элементов.

**Элементы управления:**
- Таблица `Цели`:
  - `URL` (обяз.)
  - `Селектор` (опц.)
  - `Имя` (опц.)
- `Ждать до` (WaitUntil: Load/DomContentLoaded/NetworkIdle)
- `Таймаут, сек` (TimeoutSeconds)
- `Полная страница` (FullPage)
- `ViewportWidth`/`ViewportHeight` (оба заполнены или оба пустые)

**Обязательные поля:**
- `Targets.Count >= 1`
- у каждой цели `URL` не пуст
- `TimeoutSeconds > 0`

**Как пользователь запускает:**
- заполняет Targets
- выбирает `Parallelism`
- если нужен «скрин каждые N минут»:
  - `Mode=Duration`
  - `PauseBetweenIterationsMs = N*60*1000`

**Результат:**
- файлы скриншотов + записи в отчёте (куда сохранено, какая цель).

#### A3. `ui.timing` — UI тайминги

**Назначение:** измерить метрики загрузки страницы.

**Элементы управления:**
- Таблица `Цели`:
  - `URL` (обяз.)
  - `Имя` (опц.)
- `Ждать до` (WaitUntil)
- `Таймаут, сек` (TimeoutSeconds)

**Обязательные поля:**
- `Targets.Count >= 1`
- `TimeoutSeconds > 0`

**Результат:**
- отчёт: метрики по URL (duration + navigation timing details).

---

### B. HTTP тестирование

#### B1. `http.functional` — HTTP функциональные проверки

**Назначение:** проверка эндпоинтов по условиям.

**Элементы управления (TO‑BE):**
- `BaseUrl` (обяз.)
- `TimeoutSeconds` (обяз.)
- List‑панель (слева): endpoints
  - `Имя`
  - `Метод` (GET/POST/PUT/DELETE…)
  - `Путь` (например `/api/health`)
- Details‑панель (справа):
  - `Headers` (список key/value)
  - `Body` (строка)
  - `ExpectedStatusCode` (обяз.)
  - `MaxLatencyMs` (опц.)
  - `RequireJson` (опц.)
  - `BodyContains` (опц.)
  - `HeaderContains` (список)

**Обязательные поля:**
- `BaseUrl` абсолютный
- `TimeoutSeconds > 0`
- `Endpoints.Count >= 1`

**Результат:**
- на каждый endpoint: статус, фактический код, latency, список нарушенных условий.

#### B2. `http.performance` — HTTP производительность (упрощённо)

**Назначение:** собрать метрики latency/ошибок на наборе запросов.

**Элементы управления:**
- `BaseUrl`
- `TimeoutSeconds`
- список `Endpoints` (Имя/Метод/Путь)

**Как пользователь интерпретирует нагрузку:**
- реальный RPS отдельным числом не задаётся
- нагрузка = `Parallelism × Iterations/Duration`

**Результат:**
- агрегаты latency (avg/p95/p99), total requests, errors.

#### B3. `http.assets` — HTTP ассеты

**Назначение:** проверка статических ресурсов.

**Элементы управления:**
- `TimeoutSeconds`
- таблица `Assets`:
  - `URL` (обяз.)
  - `Ожидаемый Content-Type` (опц.)
  - `Макс. задержка, мс` (опц.)
  - `Макс. размер, байт` (опц.)

**Обязательные поля:**
- `Assets.Count >= 1`
- `TimeoutSeconds > 0`

**Результат:**
- на каждый asset: доступность, latency, size, соответствие Content-Type.

---

### C. Сеть и безопасность

#### C1. `net.diagnostics` — DNS/TCP/TLS

**Назначение:** безопасная диагностика соединения.

**Элементы управления:**
- `Hostname` (обяз.)
- `AutoPortsByScheme` (флаг)
- `Ports` (список)
- `EnableDns`, `EnableTcp`, `EnableTls`

**Обязательные поля:**
- `Hostname` не пуст
- если `AutoPortsByScheme=false` → `Ports.Count >= 1`

**TO‑BE поведение AutoPortsByScheme:**
- если введён URL:
  - http → 80
  - https → 443

**Результат:**
- DNS: IP/ошибка
- TCP: connect ok/fail
- TLS: версия/сертификат/ошибка

#### C2. `net.availability` — Доступность

**Назначение:** одна проверка доступности (HTTP или TCP).

**Элементы управления:**
- `Тип цели` (Http/Tcp)
- `Цель`:
  - Http: абсолютный URL
  - Tcp: `host:port`
- `TimeoutMs`

**AS‑IS:** в модели есть `IntervalSeconds` (legacy).

**TO‑BE:**
- `IntervalSeconds` убираем из UI и из модели.
- Повтор/интервал задаём профилем:
  - `Mode=Duration`
  - `PauseBetweenIterationsMs = N*1000`.

#### C3. `net.security` — Security baseline

**Назначение:** проверить security‑заголовки и редирект.

**Элементы управления:**
- `Url` (обяз.)
- чекбоксы проверок:
  - HSTS
  - X-Content-Type-Options
  - X-Frame-Options
  - Content-Security-Policy
  - Referrer-Policy
  - Permissions-Policy
  - Redirect http→https

**Результат:**
- список проверок с результатом и пояснением.

#### C4. `net.preflight` — Preflight

**Назначение:** быстрый предстартовый чек.

**Элементы управления:**
- `Target` (опц.)
- `CheckDns/CheckTcp/CheckTls/CheckHttp`

**Использование:**
- отдельный ручной модуль
- автоматом перед запуском (если флаг Preflight включён)

**TO‑BE правило:** если preflight FAIL — основной модуль не стартует.

---

## 11. Отчёты и артефакты

### 11.1. Артефакты
- JSON отчёт (`report.json`) — всегда
- HTML отчёт (`report.html`) — если включён
- логи (`logs/run.log`) — всегда
- скриншоты (`screenshots/...`) — UI модули по политике

### 11.2. RunItem (единый контракт)
Каждый результат приводится к:
- `ItemType`, `ItemKey`
- `Status` (Success/Failed/Partial)
- `DurationMs`
- `ErrorMessage`
- `ExtraJson` (для workerId/iteration/метрик)

---

## 12. Telegram

### 12.1. Настройка пользователем
Settings → Telegram:
- `Enabled`
- `BotToken` (обяз.)
- `ChatId` (обяз.)
- `NotifyOnStart/Finish/Error`
- `ProgressMode` (Off/EveryN/EveryTSeconds)
- `ProgressEveryN`, `RateLimitSeconds`
- **TO‑BE:** `Тестовое сообщение`

### 12.2. На уровне запуска
- флаг Telegram в профиле запуска включает уведомления.
- если настройки не заполнены — предупреждение, но запуск не блокируем.

---

## 13. Тест‑план и трассируемость (минимум)

Smoke перед демонстрацией:
1) `net.preflight` → Success
2) `net.diagnostics` → Success
3) `http.functional` 1 endpoint → Success
4) `ui.snapshot` 1 URL → screenshot created
5) `Runs` → открыть JSON/папку, повторить
6) Telegram → уведомления (после внедрения персистентности)

---

## 14. Глоссарий
См. §23.

---

## 15. Нефункциональные требования (НФТ)

1. **Надёжность:** любой прогон оставляет валидный `report.json` даже при ошибке/отмене.
2. **Воспроизводимость:** повтор прогона из вкладки «Прогоны» восстанавливает конфиг+профиль.
3. **Производительность UI:** отсутствие лагов на лог‑дровере (limit 500 строк, виртуализация списка).
4. **Безопасность:** никаких атакующих функций; только безопасные проверки.
5. **Портируемость:** Windows/Linux; пути и процессы без платформенных хардкодов.
6. **Юзабилити:** единый layout, без наложений, русские подписи, понятные ошибки.

---

## Приложение A. Требования к оформлению пояснительной записки (из `Требование_Стандарт предприятия 2012.doc`)

### A1. Обязательная структура пояснительной записки
- Титульный лист
- Реферат
- Содержание
- Введение
- Основная часть
- Заключение
- Список использованных источников
- Приложения

Правила:
- каждый структурный элемент начинается **с новой страницы**;
- введение **не нумеруют**.

### A2. Требования к отдельным элементам
- **Титульный лист**: министерство/ведомство, ВУЗ, кафедра, название записки, тема, ФИО руководителя/нормоконтролёра/студента, группа, город/год.
- **Реферат**:
  - объём записки, число иллюстраций/таблиц/приложений/источников;
  - ключевые слова (5–15, прописными буквами, через запятую);
  - текст: объект, цель, содержание работ, методы, результаты/новизна, область применения, экономическая эффективность/значимость;
  - объём реферата: **1–2 страницы**.
- **Содержание**: включает введение, все разделы/подразделы/пункты, заключение, список источников, приложения с номерами страниц.
- **Основная часть**: как минимум должна покрывать:
  - аналитический обзор;
  - обоснование выбранного направления и методов;
  - описание исследований (теоретических/экспериментальных);
  - расчёты;
  - оценку достоверности результатов;
  - предложения по дальнейшим работам.

### A3. Общие требования к оформлению
- Формат: **A4**.
- Поля: **слева 20 мм, справа 10 мм, сверху 20 мм, снизу 20 мм**.
- Абзацный отступ: **10 мм**.
- Межстрочный интервал: **1,5**.
- Шрифт: **Times New Roman или Arial**, размер **12–14**.
- Нумерация страниц: арабскими цифрами; титульный лист считается первой страницей, но номер на нём не ставят.

---

## 16. Дельта внедрения (что меняем в коде 1pm)

1. Добавить `PauseBetweenIterationsMs` во все слои (DTO/VM/serialization).
2. Разделить Stop и Cancel (soft stop vs hard cancel).
3. Переписать `RunOrchestrator` под модель `N workers` (а не task-per-iteration) + поддержать pause.
4. Расширить контекст (`WorkerId`, `Iteration`) и использовать в артефактах.
5. UI‑модули: профили/скриншоты по воркерам (`profiles/w{WorkerId}`, `screenshots/w{WorkerId}`).
6. `net.availability`: убрать IntervalSeconds и внутренние циклы.
7. Telegram: сохранять/читать настройки из `settings.json`.
8. Упростить CRUD конфигов: убрать `Перезаписать`.
9. `http.functional`: list+details.
10. Playwright баннер: показывать для всех UI‑модулей.

---

## 17. Открытые вопросы

Формат: **Вопрос → моя рекомендация**

1) **Поднимаем лимит `DurationSeconds` (сейчас 60)?** → рекомендую 600 (10 минут) + предупреждение UI при >60.
2) **Нужен ли статус `Stopped` в истории прогонов?** → рекомендую да.
3) **Отправлять ли скриншоты в Telegram?** → рекомендую режим `None / OnError / Final`.
4) **Нужно ли автозагружать конфиг при выборе в ComboBox (без кнопки “Загрузить”)?** → рекомендую автозагрузку при выборе.
5) **Нужно ли логировать WorkerId/Iteration в RunItems отдельными колонками (БД) или достаточно ExtraJson?** → рекомендую начать с `ExtraJson`.
6) **Нужны ли отдельные “Профили запуска” как сущность?** → рекомендую пока **нет**.

---

## 18. Быстрый старт разработчика (build/run) — перенесено из README/docs

> Этот раздел нужен, чтобы проект можно было собрать/запустить без чтения других файлов.

### 18.1. Требования окружения
- **.NET SDK 8.x** (обязательно).
- Windows 10/11 или Linux.
- Для UI‑модулей: Playwright + Chromium (см. §2.2 и §18.3).

### 18.2. Сборка и запуск
Команды (в корне репозитория):
- `dotnet restore`
- `dotnet build`
- `dotnet run --project WebLoadTester/WebLoadTester.csproj`

При первом запуске приложение создаёт каталоги данных/прогонов в `%LocalAppData%/WebLoadTester/` (если не настроено иначе через «Настройки»).

### 18.3. Установка Chromium для Playwright
**AS‑IS:** в UI есть баннер и кнопка установки (см. §2.2), но баннер показывается только для `ui.scenario`.

**TO‑BE:** баннер должен показываться для всех UI‑модулей (`ui.scenario`, `ui.snapshot`, `ui.timing`).

CLI варианты (дополнение для docs):
- Windows: `pwsh ./playwright.ps1 install chromium`
- Linux: `./playwright.sh install chromium`

### 18.4. Траблшутинг (минимум)
- Если UI‑модуль не стартует и пишет про браузеры — установите Chromium (§18.3).
- Если БД не создаётся — проверьте путь `DataDirectory` и права на запись (§4.1, «Настройки»).

---

## 19. Каталог модулей (фактический список из кода + канонизация)

Источник AS‑IS: `Core/Domain/ModuleCatalog.cs`.

| Id | DisplayName (UI) | Family | Suffix (для FinalName) |
|---|---|---|---|
| ui.scenario | A1 UI сценарий | UI тестирование | UIСценарий |
| ui.snapshot | A2 UI снимки | UI тестирование | UISнимки |
| ui.timing | A3 UI тайминги | UI тестирование | UITайминги |
| http.functional | B1 HTTP функциональные | HTTP тестирование | HTTPФункциональные |
| http.performance | B2 HTTP производительность | HTTP тестирование | HTTPПроизводительность |
| http.assets | B3 HTTP ассеты | HTTP тестирование | HTTPАссеты |
| net.diagnostics | C1 DNS/TCP/TLS диагностика | Сеть и безопасность | СетьДиагностика |
| net.availability | C2 монитор доступности | Сеть и безопасность | СетьДоступность |
| net.security | C3 security baseline | Сеть и безопасность | SecurityBaseline |
| net.preflight | C4 preflight | Сеть и безопасность | Preflight |

**Правило:** в UI показываем русские названия модулей/семейств; Id модуля используется только как технический идентификатор.

---

## 20. SQLite: схема таблиц (фактический DDL из `SqliteRunStore`)

> Этот раздел заменяет внешние документы по данным и нужен для самодостаточной реализации.

### 20.1. TestCases
- `Id` TEXT PRIMARY KEY
- `Name` TEXT NOT NULL
- `ModuleId` TEXT NOT NULL
- `CreatedAtUtc` TEXT NOT NULL

### 20.2. TestCaseVersions
- `Id` TEXT PRIMARY KEY
- `TestCaseId` TEXT NOT NULL
- `Version` INTEGER NOT NULL
- `PayloadJson` TEXT NOT NULL
- `CreatedAtUtc` TEXT NOT NULL
- INDEX: `IX_TestCaseVersions_TestCaseId`

### 20.3. RunProfiles
- `Id` TEXT PRIMARY KEY
- `Name` TEXT NOT NULL
- `PayloadJson` TEXT NOT NULL
- `CreatedAtUtc` TEXT NOT NULL

**Важно (логика):**
- AS‑IS таблица существует, но UI управления профилями запуска сейчас не выведен.
- TO‑BE решение: либо (A) добавить CRUD профилей в «Настройки», либо (B) убрать сущность RunProfiles и хранить профиль только в конфигурациях. Выше (§0.2.6/§5) мы рекомендуем **не делать отдельный CRUD профилей** в MVP, но раз таблица уже есть — минимально допустимо оставить её как «шаблоны», не усложняя главный UI.

### 20.4. TestRuns
- `Id` TEXT PRIMARY KEY
- `TestCaseId` TEXT NOT NULL
- `TestCaseVersionId` TEXT NOT NULL
- `ModuleId` TEXT NOT NULL
- `Status` TEXT NOT NULL
- `StartedAtUtc` TEXT NOT NULL
- `FinishedAtUtc` TEXT
- `ProfileSnapshotJson` TEXT
- INDEX: `IX_TestRuns_TestCaseId`
- INDEX: `IX_TestRuns_ModuleId`

### 20.5. RunItems
- `Id` TEXT PRIMARY KEY
- `TestRunId` TEXT NOT NULL
- `ItemType` TEXT NOT NULL
- `ItemKey` TEXT NOT NULL
- `Status` TEXT NOT NULL
- `DurationMs` INTEGER NOT NULL
- `ErrorMessage` TEXT
- `ExtraJson` TEXT
- INDEX: `IX_RunItems_TestRunId`

### 20.6. Artifacts
- `Id` TEXT PRIMARY KEY
- `TestRunId` TEXT NOT NULL
- `Kind` TEXT NOT NULL
- `Path` TEXT NOT NULL
- `CreatedAtUtc` TEXT NOT NULL
- INDEX: `IX_Artifacts_TestRunId`

### 20.7. TelegramNotifications
- `Id` TEXT PRIMARY KEY
- `TestRunId` TEXT NOT NULL
- `Kind` TEXT NOT NULL
- `Message` TEXT NOT NULL
- `SentAtUtc` TEXT NOT NULL

---

## 21. UI аудит (AS‑IS) и целевые правки (TO‑BE)

### 21.1. Перевод и терминология
**AS‑IS найдено:** смешение RU/EN на формах и таблицах:
- `TargetUrl`, `TimeoutMs`, `Action/Selector/Value/DelayMs` (ui.scenario)
- `Selector/Name`, `Viewport width/height` (ui.snapshot)

**TO‑BE:** весь UI — **на русском**. Тех.термины допускаются только в подсказках/справке.
Рекомендуемый перевод:
- TargetUrl → `Стартовый URL`
- TimeoutMs → `Таймаут ожиданий, мс`
- Action → `Действие`
- Selector → `Селектор`
- Value → `Значение`
- DelayMs → `Задержка, мс`
- Viewport width/height → `Ширина viewport` / `Высота viewport`

### 21.2. Управление конфигурациями (CRUD)
**AS‑IS:** `Обновить`, `Загрузить`, `Сохранить как новую`, `Перезаписать`, `Удалить`.

**TO‑BE (принято §0.2.6):** оставить **только**:
- `Загрузить` (выбрать конфиг → подгрузить последнюю версию)
- `Сохранить` (создать новую версию; если конфиг новый — создать)
- `Удалить` (удаляет библиотечную конфигурацию; прогоны остаются)

`Перезаписать` убрать полностью.

### 21.3. Layout модуля (ModuleWorkspace)
**AS‑IS:** верхняя pinned‑панель с (A) управлением конфигом и (B) управлением запуском, ниже — ScrollViewer с настройками.

**TO‑BE:** оставить pinned‑верх как в AS‑IS (это практично), но:
- визуально отделить конфиг и запуск (2 «карты»),
- выровнять grid‑колонки (`FieldRowColumns`) на всех формах,
- избегать WrapPanel‑toolbar если он даёт переполнение — заменить на `UniformGrid`/`Grid` с переносом.

### 21.4. Playwright баннер
**AS‑IS:** показывается только в `ui.scenario`.

**TO‑BE:** показывается во всех UI‑модулях.

### 21.5. Вкладка «Прогоны»
**TO‑BE:** обязательно уметь:
- открыть папку прогона,
- открыть `report.json`/`report.html`,
- повторить запуск (подтянуть конфиг+профиль),
- удалить прогон (БД+папка `runs/{RunId}`),
- копировать RunId/путь.

---

## 22. Тест‑план и трассируемость (перенос из docs/05_TEST_PLAN_AND_TRACEABILITY.md)

### 22.1. Минимальные Smoke‑сценарии
1) `net.preflight` → Success
2) `net.diagnostics` → Success
3) `http.functional` (1 endpoint) → Success
4) `ui.snapshot` (1 URL) → screenshot created
5) `Runs` → открыть JSON/папку, повторить
6) Telegram → уведомления (после внедрения персистентности)

### 22.2. Трассируемость (высокоуровневая)
| Требование | Модуль/раздел | Проверка |
|---|---|---|
| 10 модулей, 3 семейства | §0.1, §10, §19 | Smoke: наличие вкладок/модулей |
| Единый запуск Iterations/Duration + Parallelism | §6, RunProfile | Smoke: Iterations=1, Parallelism=1 |
| Артефакты `runs/{RunId}` | §4, §11 | Smoke: папка и файлы |
| UI сценарии + скриншоты | ui.scenario/ui.snapshot | Smoke: скрин создан |
| HTTP функциональные проверки | http.functional | Smoke: статус/latency |
| DNS/TCP/TLS диагностика | net.diagnostics | Smoke: DNS/TCP/TLS ok |
| Security headers | net.security | Smoke: список проверок |
| История прогонов | §7.5 | Smoke: повтор запуска |
| Telegram уведомления | §12 | Smoke: тест/finish/error |

---

## 23. Глоссарий (перенос из docs/04_GLOSSARY.md)

**Модуль** — функциональный блок приложения, реализующий проверку/тест (UI сценарий, HTTP функциональные проверки, диагностика и т.п.). Каждый модуль имеет `ModuleId`, настройки и единый интерфейс запуска.

**Семейство модулей** — группа вкладок верхнего уровня: UI / HTTP / Сеть и безопасность.

**Конфигурация (TestCase)** — сохраняемый набор настроек модуля + профиля запуска. Имеет версионность (TestCaseVersions).

**Версия конфигурации (TestCaseVersion)** — конкретный снимок JSON настроек конфигурации на момент сохранения.

**Профиль запуска (RunProfile)** — параметры «как запускать»: Iterations/Duration, Parallelism, Timeout, пейсинг (TO‑BE), флаги скриншотов/HTML/Telegram.

**Прогон (TestRun)** — факт запуска конкретной версии конфигурации; хранится в БД и на диске (`runs/{RunId}`).

**Артефакт** — файл/ресурс, созданный во время прогона (отчёт, скриншот, лог).

**RunItem** — элемент результата (шаг UI, endpoint HTTP, порт TCP и т.п.) в едином формате (status/duration/error/extra).

**Worker** — параллельный исполнитель в рамках прогона (1..Parallelism). Имеет `WorkerId`.

**Preflight** — быстрые проверки перед запуском (DNS/TCP/TLS/HTTP). Может быть отдельным модулем и/или включаться как стадия в оркестраторе.

---

## 24. ВКР: структура и черновой план (перенос из docs/07_VKR_DRAFT.md + приложенных инструкций)

> Этот раздел нужен, чтобы текстовая работа (ПЗ) была синхронизирована с ПО.

### 24.1. Рекомендуемая структура ВКР (минимум)
1. Введение
2. Аналитический обзор (существующие инструменты, обоснование выбора)
3. Проектирование ПО (архитектура, модели, UI)
4. Реализация (ключевые компоненты, модули)
5. Тестирование (план, результаты, трассируемость)
6. Заключение
7. Источники
8. Приложения (фрагменты кода, скриншоты, схемы)

### 24.2. Дополнения по орг.ограничениям
- Соблюдать требования кафедры/университета по оформлению (см. Приложение A).
- Следить за оригинальностью текста и корректным цитированием источников.
- График/сроки и состав материалов уточнять у руководителя (т.к. требования зависят от кафедры и года).

---

## 25. Консолидация документации (что можно удалять)

**Целевое состояние репозитория:**
- `docs/INDEX.md` — этот документ (единственный исходный)
- `docs/CODEX_RULES_AND_CHANGELOG.md` — правила работы с Codex/агентами + журнал изменений

**Можно удалять после переноса (по твоему решению):**
- `docs/00_INDEX.md`, `docs/01_CANON.md`, `docs/02_ARCHITECTURE_AND_DATA.md`, `docs/03_UI_CANON.md`, `docs/04_GLOSSARY.md`, `docs/05_TEST_PLAN_AND_TRACEABILITY.md`, `docs/07_VKR_DRAFT.md`, `docs/08_FULL_SOFTWARE_DESCRIPTION.md`, `docs/README.md`, `docs/_archive/*`, `docs/_ui_mockups_svg/*`.

**Важно:** даже если удаляем файлы, все решения из них уже учтены/перенесены в разделы §0–§25 и приложения.

**Конец документа.**
