# Правила Codex и журнал изменений — WebLoadTester

**Версия:** v2.10 15.02.2026

## 1. Режим работы (обязательный)
1) Перед правками — прочитать `01–03` (и при необходимости `05–07`).
2) Любое изменение: **анализ → план → точечные правки**.
3) Минимально-инвазивно: не переписывать архитектуру «ради красоты».
4) Любая правка docs → поднять версию/дату в шапке и добавить запись в журнал.

## 2. Guardrails против типовых ошибок Avalonia/XAML (обязательный блок)
**Запрещено в Avalonia/XAML:**
- `SetterTargetType` (WPF-паттерн).
- Атрибут `Mode` в `<FluentTheme ... Mode=...>`.
- `ElementName='\"Root\"'` (кавычки внутри значения).
- `WrapPanel Spacing` (если версия Avalonia не поддерживает).
- Ручное добавление `TargetFrameworkAttribute`/дубликатов Assembly attributes.

**Требования к XAML/Bindings:**
- Для CompiledBinding всегда задавать `x:DataType` на `UserControl` и `DataTemplate`.
- Не полагаться на `DataContext` типа `object?`.
- В `DataTemplate` помнить: контекст — элемент коллекции, а не VM окна.

## 3. Guardrails против типовых ошибок SQLite
- В SQL-командах не оставлять параметр со значением `null` (использовать `DBNull.Value`).
- При nullable полях (например, `FinishedAt`) — передавать `DBNull.Value`.

## 4. Проверка готовности (acceptance для PR)
- `dotnet clean`
- `dotnet build -c Release`
- `dotnet test -c Release` (если есть тестовый проект)
- Smoke из `05_TEST_PLAN_AND_TRACEABILITY.md`

## 5. Что делать при конфликте docs
Если обнаружены разночтения:
1) фиксируем, где конфликт (файл+раздел),
2) выбираем приоритет по правилу в `01_CANON.md`,
3) синхронизируем остальные документы и код.

## 6. Журнал изменений
### v2.10 15.02.2026
- Скорректирована геометрия кнопок и центровка текста: в базовом стиле `Button` зафиксированы `HorizontalContentAlignment/VerticalContentAlignment=Center`, увеличен вертикальный `Padding`; те же выравнивания заданы для `Button.link`.
- Убраны лишние вертикальные отступы у toolbar-кнопок в `ModuleWorkspace`, что стабилизировало вертикальный ритм и исключило визуальные «провалы».
- В `ModuleWorkspace` удалена пустая промежуточная строка корневого `Grid` (`RowDefinitions` приведены к `Auto,*`), прокрутка перенесена в актуальную строку, а правая колонка «Настройки модуля» избавлена от лишней внешней карточки (`section`), чтобы убрать эффект «карточка в карточке».
- Для строки прогресса добавлено безопасное усечение (`TextTrimming`, `MaxLines=1`) для предотвращения наложения длинного текста статуса.

### v2.9 15.02.2026
- Документация приведена к консистентному набору файлов: добавлен `docs/00_INDEX.md` с картой 01–08 и рекомендуемым порядком чтения.
- Добавлен единый сводный документ `docs/08_FULL_SOFTWARE_DESCRIPTION.md` (назначение, архитектура, пайплайн прогона, модули, UI, ограничения MVP, roadmap).
- Исправлены ссылки в `README.md` и `AGENTS.md` на реально существующие файлы документации.

### v2.8 15.02.2026
- Исправлена компоновка `ModuleWorkspace`: задана явная разбивка по `Grid.Row` в верхней панели, убрано наложение строки «Модули» на прогресс/статусы и стабилизирован header-блок конфигурации (ellipsis + clip).
- Убраны ложная навигация в `SettingsWindow` и двойной скролл в `MainWindow`; прокрутка оставлена внутри рабочих областей вкладок.
- Устранены конфликты элементов форм: карточка «Конфигурация» закреплена по верхнему краю, дублирующий `Headless` в профиле удалён, булевы поля в профиле запуска и Telegram переведены на `ToggleSwitch`, увеличена высота log drawer.
- Актуализированы версии в `README.md` и `AGENTS.md`.

### v2.7 15.02.2026
- Исправлены ключевые UI-дефекты компоновки: убран жёсткий cap ширины полей, переработана адаптивность фильтров Runs и выравнивание действий в Settings без «магических» отступов.
- Добавлены стили segmented-bar для переключателя модулей (pill/chip visual state selected/unselected) и усилена консистентность action-групп при ресайзе.
- Актуализированы версии в `README.md` и `AGENTS.md`.

### v2.6 12.02.2026
- Обновлены UI-макеты shell/workspace/runs/settings под light-дизайн: карточная компоновка, pill-tabs/chips, единый drawer лога.
- Усилены дизайн-токены и базовые стили контролов для единообразной визуальной системы Avalonia 11.
- Обновлены `README.md` и `AGENTS.md` до версии v2.6 12.02.2026.

### v2.5 11.02.2026
- Сконсолидированы якорные документы до **8 файлов** (README + 7 docs), убраны дубли и битые ссылки.
- Уточнены guardrails: добавлен отдельный блок по SQLite `DBNull.Value` и актуализированы XAML-запреты.
- Актуализировано описание последних стабилизаций: pre-check перед стартом, защита от NRE в конфиг-VM, фиксы SQLite insert.

### v2.4 11.02.2026
- Ранний pre-check перед стартом: `_orchestrator.Validate(...)` вызывается до `IsRunning=true`, ошибки отображаются в `StatusText` и `StatusMessage`.
- Защита от NRE при сохранении/старте: `RunProfile` инициализируется до построения `ModuleItemViewModel`, в VM добавлены null-guards.

### v2.3 11.02.2026
- Удалён `ProfilesDirectory` из настроек приложения и UI; служебный путь профилей фиксирован как `DataDirectory/profiles`.

### v2.2 11.02.2026
- Введён `ModuleCatalog` с `ModuleSuffix`, имя конфигурации всегда `UserName_ModuleSuffix`.
- Стабилизирован compiled binding в HTTP модулях через `x:Static ...MethodOptions`.

### v2.1 11.02.2026
- CI lint в `.github/workflows/ci.yml` сделан точечным (проверяет только `Mode` внутри FluentTheme).
