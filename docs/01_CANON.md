
# Канон проекта и требования — WebLoadTester

**Версия:** v1.7 03.02.2026  
**Статус:** *Источник истины* (сначала правим здесь → затем код/макеты/прочие документы)

**Назначение:** фиксирует требования, инварианты и критерии приёмки.  
**См. также:** [02_TECH_SPEC.md](02_TECH_SPEC.md), [03_UI_SPEC.md](03_UI_SPEC.md), [04_CODE_MAP.md](04_CODE_MAP.md), [08_CODEX_RULES_AND_CHANGELOG.md](08_CODEX_RULES_AND_CHANGELOG.md).

## Навигация по якорным файлам
- `01_CANON.md` — решения, требования, границы, критерии приёмки (этот файл)
- `02_TECH_SPEC.md` — архитектура, модули, данные, отчёты, жизненный цикл прогона
- `03_UI_SPEC.md` — экраны, элементы UI, UX-правила, поведения
- `04_CODE_MAP.md` — карта файлов/классов/потоков данных
- `05_GLOSSARY.md` — единые термины
- `06_TEST_PLAN.md` — сценарии демонстрации и тест-план
- `07_TRACEABILITY.md` — требование → реализация → испытание
- `08_CODEX_RULES_AND_CHANGELOG.md` — правила работы, guardrails, changelog
- `09_VKR_DRAFT.md` — структура пояснительной записки (черновик)

---

## 1. Назначение и контекст
WebLoadTester — кроссплатформенный настольный программный комплекс (.NET 8, Avalonia 11) для **автоматизированного тестирования и диагностики веб-приложений**.

Цель продукта в прикладном смысле: быстро и воспроизводимо ответить на вопрос «что именно сломано и на каком уровне (сеть/TLS/HTTP/UI)», и сформировать доказательства в стандартизированном виде (RunId + отчёт + артефакты).

### 1.1 Заказчик (контекст для ВКР)
- Заказчик: Администрация муниципального образования город Тула.
- Подразделение: ИТ-отдел / эксплуатация веб-ресурсов.
- Объекты тестирования: внутренние ресурсы (доступ из сети заказчика) и внешние ресурсы (часть — на поддержке подрядчика).

### 1.2 Роли пользователей
- **Инженер эксплуатации / DevOps / SRE**: запускает модули, смотрит диагностику, повторяет прогоны.
- **QA/автоматизатор**: оформляет сценарии/проверки, обеспечивает воспроизводимость.
- **Разработчик**: получает RunId и доказательства, быстрее локализует причину.
- **Руководитель/менеджер**: читает HTML-отчёт и итоговые статусы.

---

## 2. Неподвижные решения (фиксируем)
Эти решения считаются «базисом» и не меняются без отдельного осознанного решения:

1) **3 семейства модулей, 10 модулей, 4 вкладки верхнего уровня**:
   - Вкладки: **UI тестирование / HTTP тестирование / Сеть и безопасность / Прогоны**.
2) **Нагрузочные режимы ядра:** только **Iterations** и **Duration**.
   - Stress/Soak/Endurance — только в разделе «Перспективы развития».
3) **Telegram — опционально** (`TelegramEnabled` в профиле запуска).
   - Ошибки Telegram не меняют итог статуса прогона.
4) **SQLite + runs/**:
   - БД: хранение тестов/версий/профилей/прогонов.
   - Файлы: артефакты и отчёты, привязанные к RunId.
5) **Отчётность:** JSON — всегда; HTML — опционально.
6) **UI-тема:** Avalonia FluentTheme, тема фиксирована `Light` через `RequestedThemeVariant`.
7) **MVVM:** CommunityToolkit.Mvvm (ReactiveUI рассматривали, отказались ради снижения инфраструктурной сложности).

---

## 3. Область применения и ограничения
### 3.1 Область применения
- Регулярные проверки доступности и работоспособности веб-ресурсов.
- Диагностика уровня проблемы: DNS/TCP/TLS/HTTP/UI.
- Документирование результатов (отчёт + артефакты) для внутреннего учёта и эскалации подрядчику.

### 3.2 Ограничения (важно для ВКР и безопасности)
- Тестирование проводится **только** ресурсов заказчика или ресурсов, на тестирование которых есть разрешение.
- Продукт **не является** инструментом пентеста/взлома и не реализует атакующие функции.
- Нагрузка контролируемая: safe defaults + лимиты + предупреждения в UI.

---

## 4. Каталог модулей (3 семейства / 10 модулей)
Ниже фиксируем состав модулей, их назначение и ключевые выходы (для трассируемости и UI).

### 4.1 Семейство A — UI тестирование (Playwright)
- **A1 UiScenario** — сценарии действий + проверки (assertions), скриншоты при ошибке/по политике.
- **A2 UiSnapshot** — визуальные снимки/аудит страниц/разделов (baseline → compare в перспективе).
- **A3 UiTiming** — замеры времени загрузки/переходов/ресурсов (метрики по итерациям).

### 4.2 Семейство B — HTTP тестирование (HttpClient)
- **B1 HttpFunctional** — функциональные проверки endpoint’ов (коды, тело, заголовки, JSON-path в перспективе).
- **B2 HttpPerformance** — контролируемые прогоны с метриками latency (avg/p95/p99), без stress/soak.
- **B3 HttpAssets** — проверки ассетов (список URL/паттернов), статусы/размеры/кеширование (минимум).

### 4.3 Семейство C — Сеть и безопасность
- **C1 NetDiagnostics** — DNS/TCP/TLS (резолвинг, подключение, версия/цепочка сертификатов, ошибки).
- **C2 Availability** — монитор доступности (пинг/HTTP HEAD/GET по выбору), простой итог OK/FAIL.
- **C3 SecurityBaseline** — базовые безопасностные проверки (HTTPS редирект, заголовки, TLS expiry и т.п. без атак).
- **C4 Preflight** — предпроверка готовности (быстрый набор проверок перед запуском тяжёлых модулей).

> Примечание: состав модулей и IDs фиксированы; детали реализации — в `02_TECH_SPEC.md` и `04_CODE_MAP.md`.

---

## 5. Ключевые сущности и понятия (минимум)
(Полные определения — в `05_GLOSSARY.md`.)

- **TestCase** — тест как объект хранения (имя, тип модуля, метаданные).
- **TestCaseVersion** — версия теста (payload настроек/сценария), создаётся при каждом сохранении.
- **RunProfile** — профиль запуска (mode/parallelism/timeouts/флаги, включая Telegram/HTML/Preflight).
- **TestRun** — прогон теста (RunId, статус, времена, snapshot профиля/версии теста).
- **ResultBase** — элемент результата (check/run/probe/timing) с Success/Duration/Error.
- **Artifacts** — файлы прогона: `report.json`, опционально `report.html`, `logs/run.log`, `screenshots/*`.

---

## 6. Функциональные требования (уровень продукта)
### 6.1 Управление тестами (Test Library)
- Создать/редактировать тест для выбранного модуля.
- Сохранить тест в БД (создаётся новая версия).
- Загрузить тест/версию из БД.

### 6.2 Профили запусков (RunProfile)
- Создать/выбрать/сохранить профиль.
- При запуске фиксировать snapshot фактически применённых параметров.

### 6.3 Выполнение прогонов
- Start/Stop/Cancel.
- Параллельность (workers).
- Прогресс выполнения и единый лог.
- Стадии: (опц.) Preflight → Running → Saving/Reporting → Done.

### 6.4 Результаты и анализ
- Вкладка «Прогоны»: список, фильтры, детали, открытие папки, повтор запуска.
- Отчёты: JSON всегда; HTML опционально.
- Telegram уведомления: опционально и не влияют на статус.

---

## 7. Нефункциональные требования
- Кроссплатформенность (Windows/Linux).
- UI без наложений, с корректным ресайзом и прокруткой.
- Воспроизводимость: фиксируем TestCaseVersion + ProfileSnapshot + RunId.
- Устойчивость: частичные сбои (Telegram/HTML/скриншот) не ломают прогон.

---

## 8. Safe defaults и лимиты
Цель: исключить случайное создание избыточной нагрузки на продуктив.

Рекомендуемые значения по умолчанию (ядро):
- **Parallelism**: 1–3
- **Mode**: Iterations (10–30) или Duration (30–60 сек)
- **TimeoutSeconds**: 15–30

Пороги предупреждений (UI):
- Parallelism > 10
- DurationSeconds > 300 (5 минут)
- Iterations > 200

---

## 9. Критерии приёмки (коротко, проверяемо)
1) Каждый запуск создаёт уникальный **RunId**, запись `TestRun` в БД и папку `runs/<runId>/`.
2) `report.json` создаётся **всегда**.
3) Артефакты прогона (лог/скриншоты/HTML при включении) сохраняются и отображаются во вкладке «Прогоны».
4) Ошибки Telegram/HTML/скриншотов **не** меняют итог статуса прогона.

---

## 10. Перспективы развития (не входит в ядро ВКР)
- Stress/Soak/Endurance режимы и расширенные стратегии нагрузки.
- Сравнение UiSnapshot baseline → diff.
- Расширенные проверки HTTP (JSONPath/Schema), расширение SecurityBaseline.
- Экспорт/импорт тестов и профилей.

---

## Связанные файлы / входы / выходы
- Входы: требования, ограничения, критерии приёмки.
- Выходы: базис для `02_TECH_SPEC.md`, `03_UI_SPEC.md`, `07_TRACEABILITY.md`.
