База данных (SQLite): структура, связи, версии и ожидаемое поведение
Версия: v1.1 24.01.2026

1) Зачем БД
БД нужна для соответствия требованиям ВКР и для практической ценности продукта:
- тест должен хранить исходные данные, процедуру и ожидаемый результат;
- тесты должны переиспользоваться и версионироваться;
- история прогонов должна быть доступна для анализа и повторного запуска.

2) Выбор решения хранения
- SQLite (файл) — основная БД (минимальная сложность, без серверной инфраструктуры).
- Файловая система — для артефактов /runs/{RunId}/...

3) Минимальная схема (достаточная для 10 модулей)
3.1 TestCases
- Id, Name, Description, ModuleType
- CreatedAt, UpdatedAt, CurrentVersion

3.2 TestCaseVersions
- Id, TestCaseId, VersionNumber, ChangedAt, ChangeNote
- PayloadJson (настройки модуля и процедура в JSON)

3.3 RunProfiles
- Id, Name
- Parallelism, Mode (Iterations/Duration), Iterations, DurationSeconds
- TimeoutsJson (или поля по умолчанию)
- Headless, ScreenshotsPolicy, HtmlReportEnabled, TelegramEnabled
- Optional: PreflightEnabled

3.4 TestRuns
- RunId
- TestCaseId, TestCaseVersion
- ProfileSnapshotJson (фактически использованные параметры)
- StartedAt, FinishedAt
- Status (Success/Failed/Partial/Cancelled)
- SummaryJson (итоговые метрики)

3.5 RunItems (детализация)
- Id, RunId
- ItemType (Step/Endpoint/Asset/NetCheck/BaselineCheck/MonitorTick)
- ItemKey (например Step#3, URL, Host:Port)
- Status, DurationMs, ErrorMessage
- Optional: ExtraJson (например код ответа, content-type и т.д.)

3.6 Artifacts
- Id, RunId
- ArtifactType (JsonReport/HtmlReport/Screenshot/Log/Other)
- RelativePath, CreatedAt

3.7 TelegramNotifications (опционально)
- Id, RunId
- SentAt
- Status (Sent/Failed)
- ErrorMessage

4) Версионность тестов (что это значит для пользователя)
- Пользователь редактирует параметры теста и нажимает “Сохранить”.
- Создаётся новая запись TestCaseVersions (новая версия).
- CurrentVersion в TestCases обновляется.
- При запуске в TestRuns фиксируется версия, чтобы прогон был воспроизводимым.

5) Путь к файлу SQLite и папке runs/
- Путь к SQLite задаётся в “Настройках” приложения (конфигурируемо).
- Рекомендуемый дефолт: каталог данных приложения (AppData) + подпапка /data.
- Папка runs/ по умолчанию рядом с выбранным каталогом данных, но может быть вынесена в настройку (опционально).

6) Retention (политика хранения)
- Артефакты физически лежат в /runs/{RunId}/...
- БД хранит ссылки.
- Минимальная реализация: ручная кнопка “Удалить прогоны старше N дней” (опционально, достаточно для ВКР).
