# Полное описание программного обеспечения WebLoadTester

**Версия:** v2.9 15.02.2026

## 1. Что это
WebLoadTester — кроссплатформенное настольное приложение на .NET 8 + Avalonia 11 для эксплуатационной диагностики веб-систем на трёх уровнях: UI, HTTP и сеть/безопасность.

Система запускает 10 модулей проверок, формирует единый `RunId`, сохраняет результаты в SQLite и создаёт папку артефактов `runs/{RunId}/`.

Ключевые свойства MVP:
- 10 модулей, 3 семейства, 4 верхнеуровневые вкладки UI;
- отчёт `report.json` формируется всегда;
- `report.html` формируется опционально;
- Telegram-уведомления опциональны и не ломают итоговый статус прогона при ошибках отправки;
- нагрузочные режимы ограничены безопасными `Iterations`/`Duration`.

## 2. Архитектура и связи

### 2.1 Слои
- **Core**: доменные модели, контракты, orchestration (жизненный цикл прогона), правила валидации.
- **Infrastructure**: реализации интеграций (SQLite, HTTP, Playwright, сетевые проверки, Telegram, файловые артефакты).
- **Modules**: 10 реализаций `ITestModule` (UI/HTTP/NetSec).
- **Presentation**: Avalonia UI (Views, ViewModels, стили, привязки).

### 2.2 Ключевые взаимодействия
1. Пользователь задаёт параметры модуля и RunProfile в UI.
2. ViewModel передаёт запрос в Core-оркестратор.
3. Оркестратор выполняет валидацию и (при включении) preflight.
4. Модуль выполняется асинхронно с `CancellationToken`, публикует прогресс и лог.
5. Итоги сохраняются в SQLite + файловые артефакты `runs/{RunId}/`.
6. Формируются отчёты (`json` всегда, `html` по флагу).
7. При включённом Telegram отправляется статус (ошибка отправки не прерывает run).

## 3. Порядок выполнения прогона (по шагам)
1. **Выбор семейства и модуля**: UI/HTTP/Net и конкретный модуль A1–C4.
2. **Настройка модуля**: заполнение обязательных полей в секции «Настройки модуля».
3. **Настройка параметров запуска (RunProfile)**:
   - `Parallelism`, `Mode` (`Iterations`/`Duration`), таймаут;
   - флаги `HTML report`, `Telegram`, `Preflight`;
   - UI-специфика (например, политика скриншотов).
4. **Предстартовая валидация**:
   - проверка обязательных полей;
   - проверка корректности режима нагрузки и границ значений;
   - проверка корректности выбранной/сохранённой конфигурации модуля.
5. **Опциональный preflight** (если включён): быстрые DNS/TCP/TLS/HTTP проверки доступности.
6. **Основное выполнение модуля**:
   - асинхронное выполнение;
   - публикация прогресса и логов;
   - поддержка отмены через `CancellationToken`.
7. **Сохранение результатов**:
   - запись summary и items в SQLite;
   - сохранение файлов в `runs/{RunId}/`.
8. **Генерация отчётов**:
   - `report.json` — всегда;
   - `report.html` — по флагу профиля.
9. **Пост-обработка**:
   - обновление вкладки «Прогоны»;
   - отправка Telegram-уведомлений (если включены).

## 4. Модули A/B/C

### 4.1 Семейство A — UI
- **A1 `ui.scenario`**: сценарные шаги (`navigate/click/fill/assert`), метрики шагов, скриншоты по политике.
- **A2 `ui.snapshot`**: массовые скриншоты списка URL.
- **A3 `ui.timing`**: измерение времени загрузки/навигации.

### 4.2 Семейство B — HTTP
- **B1 `http.functional`**: функциональные HTTP-проверки (статусы/заголовки/контент).
- **B2 `http.performance`**: контролируемая нагрузка (только `Iterations`/`Duration`).
- **B3 `http.assets`**: валидация статических ассетов (доступность/типы/кэш-политики).

### 4.3 Семейство C — Network/Security
- **C1 `net.diagnostics`**: DNS/TCP/TLS диагностика.
- **C2 `net.availability`**: проверки доступности (probe).
- **C3 `net.security`**: baseline security-проверки (без атакующих функций).
- **C4 `net.preflight`**: быстрый preflight перед основным запуском.

## 5. UI: что где и что происходит

### 5.1 Главный экран (`MainWindow`)
- Верхняя карточка с общими действиями (настройки, папка прогонов, статусы DB/Telegram).
- `TabControl` с 4 вкладками:
  1. **UI тестирование**;
  2. **HTTP тестирование**;
  3. **Сеть и безопасность**;
  4. **Прогоны**.
- Нижний `Log Drawer` (раскрываемый): фильтр ошибок, автоскролл, очистка/копирование.

### 5.2 Рабочая область модуля (`ModuleWorkspace`)
- Верхняя панель: прогресс, стадия, текст статуса, кнопки запуска/перезапуска/остановки/отмены.
- Блок выбора модуля внутри семейства.
- Левая колонка: «Конфигурация» (загрузка/сохранение/удаление конфигов).
- Правая колонка: настройки конкретного модуля.
- Блок «Параметры запуска» (RunProfile).
- Блок «Результаты и артефакты» с summary + таблицей результатов.

### 5.3 Окно настроек (`SettingsWindow`)
- Единая колонка с прокруткой.
- Секция «Пути хранения» (каталоги данных/прогонов и путь к БД).
- Секция «Telegram» (token/chatId/режим уведомлений/частота прогресса).
- Нижняя панель действий: «Отмена» и «Сохранить».

### 5.4 Поведение ключевых кнопок
- **Старт**: запускает валидацию + (опционально) preflight + основной модуль.
- **Перезапуск**: повтор запуска на актуальных параметрах.
- **Остановить/Отмена**: инициирует отмену через `CancellationToken`.
- **Обновить/Загрузить/Сохранить/Перезаписать/Удалить**: управление конфигурациями выбранного модуля.

## 6. Данные, отчёты и артефакты

### 6.1 SQLite
SQLite используется как обязательное хранилище:
- профили запусков;
- история прогонов;
- агрегированные результаты и метаданные;
- связи run ↔ module ↔ artifacts.

### 6.2 Файловые артефакты
Для каждого запуска создаётся `runs/{RunId}/`:
- `report.json` — всегда;
- `report.html` — по флагу;
- `logs/run.log` — журналы выполнения;
- `screenshots/` — скриншоты UI-модулей.

### 6.3 Telegram
Telegram-канал оповещения является опциональным:
- отправка статуса старта/финиша/ошибки и прогресса по настройкам;
- ошибка Telegram фиксируется в логе, но не переводит run в failed из-за уведомления.

## 7. Ограничения MVP
- Нет атакующих функций и stress/soak-режимов.
- Нагрузка ограничена `Iterations`/`Duration` с безопасными границами.
- UI-операции выполняются без блокировки потока (async + cancellation).
- Нет расширенной аналитики сравнения прогонов «из коробки» (только базовая история и отчёты).
- Функции, не реализованные в текущем UI/коде, трактуются как roadmap, а не как факт.

## 8. Roadmap
- Расширенные режимы и сценарии нагрузки (после отдельной валидации безопасности и UX).
- Расширенный diff отчётов между прогонами.
- Более детальные security baseline-проверки (без перехода к атакующим сценариям).
- Улучшенные дашборды агрегированных метрик и экспорт сводных отчётов.
- Автоматизация типовых smoke-последовательностей для всех 10 модулей.
