<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:WebLoadTester.Presentation.ViewModels.SettingsViewModels"
             xmlns:modules="clr-namespace:WebLoadTester.Modules.HttpFunctional"
             x:Class="WebLoadTester.Presentation.Views.SettingsViews.HttpFunctionalSettingsView"
             x:DataType="vm:HttpFunctionalSettingsViewModel"
             x:Name="Root">
    <StackPanel Spacing="16">
        <Border Classes="section">
            <StackPanel Spacing="8">
                <TextBlock Text="Базовые настройки" Classes="section-title" />
                <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                    <TextBlock Text="Base URL" Classes="field-label" />
                    <TextBox Classes="field-control" Text="{Binding BaseUrl, Mode=TwoWay}" />
                </Grid>
                <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                    <TextBlock Text="Таймаут (сек)" Classes="field-label" />
                    <NumericUpDown Classes="field-control" Minimum="1" Value="{Binding TimeoutSeconds, Mode=TwoWay}" />
                </Grid>
            </StackPanel>
        </Border>

        <Border Classes="section">
            <StackPanel Spacing="8">
                <TextBlock Text="Endpoints (List + Details)" Classes="section-title" />
                <Grid ColumnDefinitions="300,*" ColumnSpacing="12">
                    <StackPanel Spacing="8">
                        <WrapPanel Classes="wrap-gap">
                            <Button Content="Добавить" Command="{Binding AddEndpointCommand}" />
                            <Button Content="Удалить" Command="{Binding RemoveSelectedEndpointCommand}" />
                            <Button Content="Дублировать" Command="{Binding DuplicateSelectedEndpointCommand}" />
                        </WrapPanel>

                        <ListBox ItemsSource="{Binding Endpoints}"
                                 SelectedItem="{Binding SelectedEndpoint, Mode=TwoWay}"
                                 MinHeight="220">
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="modules:HttpFunctionalEndpoint">
                                    <TextBlock Text="{Binding Name}" />
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>

                    <Border Grid.Column="1" Classes="section">
                        <StackPanel Spacing="8" IsVisible="{Binding SelectedEndpoint, Converter={StaticResource NullToBoolConverter}}">
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Name" Classes="field-label" />
                                <TextBox Classes="field-control" Text="{Binding SelectedEndpoint.Name, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Method" Classes="field-label" />
                                <ComboBox Classes="field-control"
                                          ItemsSource="{x:Static modules:HttpFunctionalEndpoint.MethodOptions}"
                                          SelectedItem="{Binding SelectedEndpoint.Method, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Path" Classes="field-label" />
                                <TextBox Classes="field-control" Text="{Binding SelectedEndpoint.Path, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="ExpectedStatusCode" Classes="field-label" />
                                <NumericUpDown Classes="field-control" Minimum="100" Maximum="599" Value="{Binding SelectedEndpoint.ExpectedStatusCode, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="RequiredHeaders" Classes="field-label" ToolTip.Tip="Формат: Header или Header:Value. Несколько правил через ;" />
                                <TextBox Classes="field-control"
                                         Watermark="Content-Type:application/json;X-Trace-Id"
                                         Text="{Binding SelectedEndpoint.RequiredHeadersText, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="BodyContains" Classes="field-label" />
                                <TextBox Classes="field-control" Text="{Binding SelectedEndpoint.BodyContains, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="JsonFieldEquals" Classes="field-label" ToolTip.Tip="Формат: path=value; поддерживаются items[0].id и items.0.id" />
                                <TextBox Classes="field-control"
                                         Watermark="data.items[0].id=42;data.items.0.type=main"
                                         Text="{Binding SelectedEndpoint.JsonFieldEqualsText, Mode=TwoWay}" />
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>
            </StackPanel>
        </Border>
    </StackPanel>
</UserControl>
