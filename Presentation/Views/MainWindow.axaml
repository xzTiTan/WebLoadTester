<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:WebLoadTester.Presentation.ViewModels"
        xmlns:tabs="clr-namespace:WebLoadTester.Presentation.Views.Tabs"
        xmlns:behaviors="clr-namespace:WebLoadTester.Presentation.Common.Behaviors"
        x:Class="WebLoadTester.Presentation.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="WebLoadTester"
        Width="1200"
        Height="800"
        MinWidth="1024"
        MinHeight="720"
        Background="{DynamicResource PageBackground}">
    <Grid RowDefinitions="*,Auto">
        <Grid Grid.Row="0"
              Margin="{DynamicResource PagePadding}"
              HorizontalAlignment="Center"
              MaxWidth="1400"
              RowDefinitions="Auto,*"
              RowSpacing="{DynamicResource CardSpacing}">
            <Border Grid.Row="0" Classes="app-bar">
                <Grid RowDefinitions="Auto,Auto" RowSpacing="{DynamicResource FieldSpacing}">
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <StackPanel>
                            <TextBlock Text="WebLoadTester" Classes="page-title" />
                            <TextBlock Text="Панель управления" Classes="muted" />
                        </StackPanel>
                        <Button Grid.Column="1"
                                Classes="secondary toolbar-button"
                                Content="Настройки"
                                Command="{Binding OpenSettingsCommand}" />
                    </Grid>

                    <WrapPanel Grid.Row="1" Classes="wrap-gap">
                        <Button Classes="secondary toolbar-button"
                                Content="Папка прогонов"
                                Command="{Binding OpenRunsFolderCommand}" />
                        <Border Classes="badge">
                            <TextBlock Text="{Binding DatabaseStatus}" FontSize="12" FontWeight="SemiBold" />
                        </Border>
                        <Border Classes="badge">
                            <TextBlock Text="{Binding TelegramStatus}" FontSize="12" FontWeight="SemiBold" />
                        </Border>
                        <Border Classes="badge warn">
                            <TextBlock Text="Playwright: через баннер модуля" FontSize="12" FontWeight="SemiBold" />
                        </Border>
                    </WrapPanel>
                </Grid>
            </Border>

            <Border Grid.Row="1" Classes="section" Padding="{DynamicResource CardPadding}">
                <TabControl Classes="main-tabs" SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}">
                    <TabItem Header="UI тестирование">
                        <tabs:UiTestingTab DataContext="{Binding UiFamily}" />
                    </TabItem>
                    <TabItem Header="HTTP тестирование">
                        <tabs:HttpTestingTab DataContext="{Binding HttpFamily}" />
                    </TabItem>
                    <TabItem Header="Сеть и безопасность">
                        <tabs:NetSecTab DataContext="{Binding NetFamily}" />
                    </TabItem>
                    <TabItem Header="Прогоны">
                        <tabs:RunsTab DataContext="{Binding RunsTab}" />
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>

        <Border Grid.Row="1"
                Margin="16,0,16,16"
                HorizontalAlignment="Center"
                MaxWidth="1400"
                Classes="section"
                Padding="12">
            <Expander IsExpanded="{Binding IsLogDrawerExpanded}">
                <Expander.Header>
                    <TextBlock Text="Лог выполнения" VerticalAlignment="Center" FontWeight="SemiBold" />
                </Expander.Header>

                <Grid RowDefinitions="Auto,*" RowSpacing="8" Margin="0,8,0,0" MinHeight="200" MaxHeight="340">
                    <WrapPanel Grid.Row="0" Classes="wrap-gap">
                        <CheckBox Content="Автоскролл" IsChecked="{Binding LogAutoScroll, Mode=TwoWay}" />
                        <CheckBox Content="Только ошибки" IsChecked="{Binding LogOnlyErrors, Mode=TwoWay}" />
                        <Button Classes="link" Content="Очистить" Command="{Binding ClearLogCommand}" />
                        <Button Classes="link" Content="Копировать" Command="{Binding CopyLogCommand}" />
                    </WrapPanel>

                    <Border Grid.Row="1" Classes="log-box">
                        <ListBox ItemsSource="{Binding FilteredLogEntries}"
                                 Classes="loglist"
                                 behaviors:AutoScrollBehavior.IsEnabled="{Binding LogAutoScroll}">
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <TextBlock Classes="logline" Text="{Binding}" />
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                </Grid>
            </Expander>
        </Border>
    </Grid>
</Window>
