<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:WebLoadTester.Presentation.ViewModels"
        x:Class="WebLoadTester.Presentation.Views.SettingsWindow"
        x:DataType="vm:SettingsWindowViewModel"
        Title="Настройки"
        Width="1200" Height="760"
        MinWidth="960" MinHeight="640"
        WindowStartupLocation="CenterOwner">
    <Grid RowDefinitions="*,Auto" Margin="16">
        <Border Grid.Row="0" Classes="section">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="16" MinWidth="560">
                    <Border Classes="section">
                        <StackPanel Spacing="10">
                            <TextBlock Text="Пути хранения" Classes="section-title" />

                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Каталог данных" Classes="field-label" />
                                <TextBox Classes="field-control" Watermark="Выберите каталог данных" Text="{Binding DataDirectory, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <Border Grid.Column="1" Background="Transparent">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Button Content="Выбрать" Command="{Binding BrowseDataDirectoryCommand}" />
                                        <Button Content="Открыть" Command="{Binding OpenDataDirectoryCommand}" />
                                        <Button Content="Копировать" Command="{Binding CopyDataDirectoryCommand}" />
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Каталог прогонов" Classes="field-label" />
                                <TextBox Classes="field-control" Watermark="Выберите каталог прогонов" Text="{Binding RunsDirectory, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <Border Grid.Column="1" Background="Transparent">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Button Content="Выбрать" Command="{Binding BrowseRunsDirectoryCommand}" />
                                        <Button Content="Открыть" Command="{Binding OpenRunsDirectoryCommand}" />
                                        <Button Content="Копировать" Command="{Binding CopyRunsDirectoryCommand}" />
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Путь к БД" Classes="field-label" />
                                <TextBox Classes="field-control" Text="{Binding DatabasePath}" IsReadOnly="True" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <Border Grid.Column="1" Background="Transparent">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Button Content="Открыть" Command="{Binding OpenDatabasePathCommand}" />
                                        <Button Content="Копировать" Command="{Binding CopyDatabasePathCommand}" />
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <TextBlock Text="Артефакты прогонов сохраняются в runs/{RunId}/ (report.json, report.html, screenshots/, logs/)." TextWrapping="Wrap" Classes="status-line" />
                        </StackPanel>
                    </Border>

                    <Border Classes="section">
                        <StackPanel Spacing="10">
                            <TextBlock Text="Телеграм" Classes="section-title" />
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Токен бота" Classes="field-label" />
                                <TextBox Classes="field-control" Watermark="Введите токен бота" Text="{Binding TelegramSettings.BotToken, Mode=TwoWay}" PasswordChar="*" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Идентификатор чата" Classes="field-label" />
                                <TextBox Classes="field-control" Watermark="Введите идентификатор чата" Text="{Binding TelegramSettings.ChatId, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Включить Телеграм" Classes="field-label" />
                                <ToggleSwitch Classes="field-control" IsChecked="{Binding TelegramSettings.Enabled, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="О старте" Classes="field-label" />
                                <ToggleSwitch Classes="field-control" IsChecked="{Binding TelegramSettings.NotifyOnStart, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="О завершении" Classes="field-label" />
                                <ToggleSwitch Classes="field-control" IsChecked="{Binding TelegramSettings.NotifyOnFinish, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Об ошибке" Classes="field-label" />
                                <ToggleSwitch Classes="field-control" IsChecked="{Binding TelegramSettings.NotifyOnError, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Режим прогресса" Classes="field-label" />
                                <ComboBox Classes="field-control"
                                          ItemsSource="{Binding TelegramSettings.ProgressModes}"
                                          SelectedItem="{Binding TelegramSettings.ProgressMode, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Прогресс каждые N" Classes="field-label" />
                                <TextBox Classes="field-control" Watermark="Например: 10" Text="{Binding TelegramSettings.ProgressEveryN, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Ограничение частоты (сек)" Classes="field-label" />
                                <TextBox Classes="field-control" Watermark="Например: 5" Text="{Binding TelegramSettings.RateLimitSeconds, Mode=TwoWay}" />
                            </Grid>
                            <Grid ColumnDefinitions="{StaticResource FieldRowColumns}" Classes="field-row">
                                <TextBlock Text="Тест" Classes="field-label" />
                                <WrapPanel Grid.Column="1" Classes="wrap-gap">
                                    <Button Content="Тестовое сообщение"
                                            Command="{Binding TelegramSettings.SendTestMessageCommand}"
                                            IsEnabled="{Binding TelegramSettings.CanSendTestMessage}" />
                                    <TextBlock Text="{Binding TelegramSettings.TestMessageStatus}" Classes="status-line" VerticalAlignment="Center" />
                                </WrapPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <Border Grid.Row="1" Classes="section" Padding="12">
            <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
                <TextBlock Text="Подсказка: настройки применяются для следующих запусков."
                           Classes="status-line"
                           VerticalAlignment="Center" />
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Content="Отмена" IsCancel="True" />
                    <Button Content="Сохранить" Classes="primary" Command="{Binding SaveCommand}" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
